<?php

namespace Database\Seeders;

use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Log;

class PostalCodeZoneSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        // Καθαρισμός του πίνακα πριν την εισαγωγή νέων δεδομένων
        // Διαγραφή όλων των εγγραφών αντί για truncate για να αποφύγουμε προβλήματα με τα foreign keys
        DB::table('postal_code_zones')->delete();

        // Ταχυδρομικοί κώδικες για τη Ζώνη 6 (Αθήνα)
        $athensPostalCodes = [
            '104', '105', '106', '107', '108', '109', // Κέντρο Αθήνας
            '110', '111', '112', '113', '114', '115', '116', '117', '118', '119', // Κεντρικές περιοχές
        ];

        // Ταχυδρομικοί κώδικες για τη Ζώνη 7 (Θεσσαλονίκη)
        $thessalonikiPostalCodes = [
            '546', '547', '548', '549', // Κέντρο Θεσσαλονίκης
            '550', '551', '552', '553', '554', '555', '556', '557', '558', '559', // Κεντρικές περιοχές Θεσσαλονίκης
            '560', '561', '562', '563', '564', '565', '566', '567', '568', '569', // Κεντρικές περιοχές Θεσσαλονίκης
        ];

        // Ταχυδρομικοί κώδικες για τη Ζώνη 1 (Αστικά Κέντρα - Αθήνα/Θεσσαλονίκη)
        // Περιλαμβάνει ευρύτερες περιοχές Αθήνας και Θεσσαλονίκης που δεν είναι στις ζώνες 6 και 7
        $urbanCentersPostalCodes = [
            // Ευρύτερη περιοχή Αθήνας
            '100', '101', '102', '103', // Περιοχές Αθήνας που δεν καλύπτονται από τη Ζώνη 6
            '120', '121', '122', '123', '124', '125', '126', '127', '128', '129', // Προάστια Αθήνας
            '130', '131', '132', '133', '134', '135', '136', '137', '138', '139', // Προάστια Αθήνας
            '140', '141', '142', '143', '144', '145', '146', '147', '148', '149', // Προάστια Αθήνας
            '150', '151', '152', '153', '154', '155', '156', '157', '158', '159', // Προάστια Αθήνας
            '160', '161', '162', '163', '164', '165', '166', '167', '168', '169', // Προάστια Αθήνας
            '170', '171', '172', '173', '174', '175', '176', '177', '178', '179', // Προάστια Αθήνας
            // Ευρύτερη περιοχή Θεσσαλονίκης
            '530', '531', '532', '533', '534', '535', '536', '537', '538', '539', // Περιοχές Θεσσαλονίκης που δεν καλύπτονται από τη Ζώνη 7
            '540', '541', '542', '543', '544', '545', // Περιοχές Θεσσαλονίκης που δεν καλύπτονται από τη Ζώνη 7
            '570', '571', '572', '573', '574', '575', '576', '577', '578', '579', // Προάστια Θεσσαλονίκης
        ];

        // Ταχυδρομικοί κώδικες για τη Ζώνη 2 (Πρωτεύουσες Νομών Ηπειρωτικής Ελλάδας)
        $mainlandCapitalsPostalCodes = [
            '2210', // Πάτρα
            '2410', // Καλαμάτα
            '2710', // Ιωάννινα
            '3010', // Αγρίνιο
            '3210', // Λαμία
            '3510', // Λάρισα
            '3710', // Βόλος
            '4310', // Κοζάνη
            '4510', // Ιωάννινα
            '4910', // Κομοτηνή
            '5210', // Δράμα
            '5810', // Σέρρες (αλλαγή από 551 σε 5810 για να αποφύγουμε τη σύγκρουση με τη ζώνη 7)
            '5910', // Βέροια
            '6110', // Κατερίνη
            '6510', // Καβάλα
            '6710', // Ξάνθη
            '6910', // Αλεξανδρούπολη
        ];

        // Ταχυδρομικοί κώδικες για τη Ζώνη 3 (Λοιπή Ηπειρωτική Ελλάδα & Εύβοια)
        // Περιλαμβάνει όλους τους υπόλοιπους ταχυδρομικούς κώδικες της ηπειρωτικής Ελλάδας
        $mainlandPostalCodes = [
            '200', '201', '202', '203', '204', '205', '206', '207', '208', '209',
            '210', '211', '212', '213', '214', '215', '216', '217', '218', '219',
            '220', '222', '223', '224', '225', '226', '227', '228', '229',
            '230', '231', '232', '233', '234', '235', '236', '237', '238', '239',
            '240', '242', '243', '244', '245', '246', '247', '248', '249',
            '250', '251', '252', '253', '254', '255', '256', '257', '258', '259',
            '260', '261', '262', '263', '264', '265', '266', '267', '268', '269',
            '270', '272', '273', '274', '275', '276', '277', '278', '279',
            '280', '281', '282', '283', '284', '285', '286', '287', '288', '289',
            '290', '291', '292', '293', '294', '295', '296', '297', '298', '299',
            '300', '302', '303', '304', '305', '306', '307', '308', '309',
            '310', '311', '312', '313', '314', '315', '316', '317', '318', '319',
            '320', '322', '323', '324', '325', '326', '327', '328', '329',
            '330', '331', '332', '333', '334', '335', '336', '337', '338', '339',
            '340', '341', '342', '343', '344', '345', '346', '347', '348', '349',
            '350', '352', '353', '354', '355', '356', '357', '358', '359',
            '360', '361', '362', '363', '364', '365', '366', '367', '368', '369',
            '370', '372', '373', '374', '375', '376', '377', '378', '379',
            '380', '381', '382', '383', '384', '385', '386', '387', '388', '389',
            '390', '391', '392', '393', '394', '395', '396', '397', '398', '399',
            '400', '401', '402', '403', '404', '405', '406', '407', '408', '409',
            '410', '411', '412', '413', '414', '415', '416', '417', '418', '419',
            '420', '421', '422', '423', '424', '425', '426', '427', '428', '429',
            '430', '432', '433', '434', '435', '436', '437', '438', '439',
            '440', '441', '442', '443', '444', '445', '446', '447', '448', '449',
            '450', '452', '453', '454', '455', '456', '457', '458', '459',
            '460', '461', '462', '463', '464', '465', '466', '467', '468', '469',
            '470', '471', '472', '473', '474', '475', '476', '477', '478', '479',
            '480', '481', '482', '483', '484', '485', '486', '487', '488', '489',
            '490', '492', '493', '494', '495', '496', '497', '498', '499',
            '500', '501', '502', '503', '504', '505', '506', '507', '508', '509',
            '510', '511', '512', '513', '514', '515', '516', '517', '518', '519',
            '520', '522', '523', '524', '525', '526', '527', '528', '529',
            '580', '582', '583', '584', '585', '586', '587', '588', '589',
            '590', '592', '593', '594', '595', '596', '597', '598', '599',
            '600', '601', '602', '603', '604', '605', '606', '607', '608', '609',
            '610', '612', '613', '614', '615', '616', '617', '618', '619',
            '620', '621', '622', '623', '624', '625', '626', '627', '628', '629',
            '630', '631', '632', '633', '634', '635', '636', '637', '638', '639',
            '640', '641', '642', '643', '644', '645', '646', '647', '648', '649',
            '650', '652', '653', '654', '655', '656', '657', '658', '659',
            '660', '661', '662', '663', '664', '665', '666', '667', '668', '669',
            '670', '672', '673', '674', '675', '676', '677', '678', '679',
            '680', '681', '682', '683', '684', '685', '686', '687', '688', '689',
            '690', '692', '693', '694', '695', '696', '697', '698', '699',
            '700', '701', '702', '703', '704', '705', '706', '707', '708', '709',
            '710', '711', '712', '713', '714', '715', '716', '717', '718', '719',
            '720', '721', '722',
        ];

        // Ταχυδρομικοί κώδικες για τη Ζώνη 4 (Νησιά - Εξαιρουμένων Δυσπρόσιτων)
        $islandsPostalCodes = [
            '730', '731', '732', '733', '734', '735', '736', '737', '738', '739', // Χανιά
            '740', '741', '742', '743', '744', '745', '746', '747', '748', '749', // Ρέθυμνο
            '750', '751', '752', '753', '754', '755', '756', '757', '758', '759', // Ηράκλειο
            '760', '761', '762', '763', '764', '765', '766', '767', '768', '769', // Λασίθι
            '810', '811', '812', '813', '814', '815', '816', '817', '818', '819', // Μυτιλήνη
            '820', '821', '822', '823', '824', '825', '826', '827', '828', '829', // Χίος
            '830', '831', '832', '833', '834', '835', '836', '837', '838', '839', // Σάμος
            '840', '841', '842', '843', '844', '845', '846', '847', '848', '849', // Σύρος, Μύκονος, Πάρος, Νάξος
            '850', '851', '852', '853', '854', '855', '856', '857', '858', '859', // Ρόδος, Κως
            '490', '491', '492', '493', '494', '495', '496', '497', '498', '499', // Κέρκυρα
        ];

        // Ταχυδρομικοί κώδικες για τη Ζώνη 5 (Δυσπρόσιτες Περιοχές)
        $remotePostalCodes = [
            '1800', '1801', '1802', '1803', '1804', '1805', '1806', '1807', '1808', '1809', // Αίγινα
            '1810', '1811', '1812', '1813', '1814', '1815', '1816', '1817', '1818', '1819', // Σαλαμίνα
            '1820', '1821', '1822', '1823', '1824', '1825', '1826', '1827', '1828', '1829', // Πόρος
            '1830', '1831', '1832', '1833', '1834', '1835', '1836', '1837', '1838', '1839', // Ύδρα
            '1840', '1841', '1842', '1843', '1844', '1845', '1846', '1847', '1848', '1849', // Σπέτσες
            '1850', '1851', '1852', '1853', '1854', '1855', '1856', '1857', '1858', '1859', // Γαλατάς
            '1860', '1861', '1862', '1863', '1864', '1865', '1866', '1867', '1868', '1869', // Μέθανα
            '1870', '1871', '1872', '1873', '1874', '1875', '1876', '1877', '1878', '1879', // Κύθηρα
            '1880', '1881', '1882', '1883', '1884', '1885', '1886', '1887', '1888', '1889', // Αντικύθηρα
            '1890', '1891', '1892', '1893', '1894', '1895', '1896', '1897', '1898', '1899', // Άλλα μικρά νησιά
            '7200', '7201', '7202', '7203', '7204', '7205', '7206', '7207', '7208', '7209', // Ικαρία
            '7210', '7211', '7212', '7213', '7214', '7215', '7216', '7217', '7218', '7219', // Φούρνοι
            '7220', '7221', '7222', '7223', '7224', '7225', '7226', '7227', '7228', '7229', // Θύμαινα
            '7230', '7231', '7232', '7233', '7234', '7235', '7236', '7237', '7238', '7239', // Άγιος Ευστράτιος
            '7240', '7241', '7242', '7243', '7244', '7245', '7246', '7247', '7248', '7249', // Ψαρά
            '7250', '7251', '7252', '7253', '7254', '7255', '7256', '7257', '7258', '7259', // Οινούσσες
            '7260', '7261', '7262', '7263', '7264', '7265', '7266', '7267', '7268', '7269', // Λήμνος
            '7270', '7271', '7272', '7273', '7274', '7275', '7276', '7277', '7278', '7279', // Σαμοθράκη
            '7280', '7281', '7282', '7283', '7284', '7285', '7286', '7287', '7288', '7289', // Θάσος
            '7290', '7291', '7292', '7293', '7294', '7295', '7296', '7297', '7298', '7299', // Άλλα μικρά νησιά
            '8500', '8501', '8502', '8503', '8504', '8505', '8506', '8507', '8508', '8509', // Κάρπαθος
            '8510', '8511', '8512', '8513', '8514', '8515', '8516', '8517', '8518', '8519', // Κάσος
            '8520', '8521', '8522', '8523', '8524', '8525', '8526', '8527', '8528', '8529', // Τήλος
            '8530', '8531', '8532', '8533', '8534', '8535', '8536', '8537', '8538', '8539', // Νίσυρος
            '8540', '8541', '8542', '8543', '8544', '8545', '8546', '8547', '8548', '8549', // Σύμη
            '8550', '8551', '8552', '8553', '8554', '8555', '8556', '8557', '8558', '8559', // Χάλκη
            '8560', '8561', '8562', '8563', '8564', '8565', '8566', '8567', '8568', '8569', // Μεγίστη (Καστελόριζο)
            '8570', '8571', '8572', '8573', '8574', '8575', '8576', '8577', '8578', '8579', // Λειψοί
            '8580', '8581', '8582', '8583', '8584', '8585', '8586', '8587', '8588', '8589', // Λέρος
            '8590', '8591', '8592', '8593', '8594', '8595', '8596', '8597', '8598', '8599', // Πάτμος
            '8600', '8601', '8602', '8603', '8604', '8605', '8606', '8607', '8608', '8609', // Αστυπάλαια
            '8610', '8611', '8612', '8613', '8614', '8615', '8616', '8617', '8618', '8619', // Κάλυμνος
            '8620', '8621', '8622', '8623', '8624', '8625', '8626', '8627', '8628', '8629', // Αγαθονήσι
            '8630', '8631', '8632', '8633', '8634', '8635', '8636', '8637', '8638', '8639', // Αρκοί
            '8640', '8641', '8642', '8643', '8644', '8645', '8646', '8647', '8648', '8649', // Τέλενδος
            '8650', '8651', '8652', '8653', '8654', '8655', '8656', '8657', '8658', '8659', // Ψέριμος
        ];

        // Εισαγωγή των ταχυδρομικών κωδίκων στον πίνακα
        $this->insertPostalCodes($athensPostalCodes, 6);
        $this->insertPostalCodes($thessalonikiPostalCodes, 7);
        $this->insertPostalCodes($urbanCentersPostalCodes, 1);
        $this->insertPostalCodes($mainlandCapitalsPostalCodes, 2);
        $this->insertPostalCodes($mainlandPostalCodes, 3);
        $this->insertPostalCodes($islandsPostalCodes, 4);
        $this->insertPostalCodes($remotePostalCodes, 5);

        // Καταγραφή του αριθμού των εγγραφών που εισήχθησαν
        $count = DB::table('postal_code_zones')->count();
        Log::info("PostalCodeZoneSeeder: Inserted {$count} postal code zone mappings.");
        $this->command->info("Inserted {$count} postal code zone mappings.");
    }

    /**
     * Εισαγωγή ταχυδρομικών κωδίκων για μια συγκεκριμένη ζώνη.
     *
     * @param array $postalCodes Οι ταχυδρομικοί κώδικες
     * @param int $zoneId Το ID της ζώνης
     */
    private function insertPostalCodes(array $postalCodes, int $zoneId): void
    {
        foreach ($postalCodes as $postalCode) {
            // Έλεγχος αν υπάρχει ήδη ο ταχυδρομικός κώδικας
            $exists = DB::table('postal_code_zones')
                ->where('postal_code_prefix', $postalCode)
                ->exists();

            if (!$exists) {
                // Εισαγωγή μόνο αν δεν υπάρχει ήδη
                DB::table('postal_code_zones')->insert([
                    'postal_code_prefix' => $postalCode,
                    'shipping_zone_id' => $zoneId,
                ]);
            }
        }
    }
}
