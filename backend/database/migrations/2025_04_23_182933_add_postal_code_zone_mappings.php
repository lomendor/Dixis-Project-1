<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
use Illuminate\Support\Facades\DB;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        // Εισαγωγή των ταχυδρομικών κωδίκων για τη Ζώνη 6 (Αθήνα)
        $athensPostalCodes = [
            '104', '105', '106', '107', '108', '109', // Κέντρο Αθήνας
            '110', '111', '112', '113', '114', '115', '116', '117', '118', '119', // Κεντρικές περιοχές
        ];

        // Εισαγωγή των ταχυδρομικών κωδίκων για τη Ζώνη 7 (Θεσσαλονίκη)
        $thessalonikiPostalCodes = [
            '546', '547', '548', '549', // Κέντρο Θεσσαλονίκης
            '550', '551', '552', '553', '554', '555', '556', '557', '558', '559', // Κεντρικές περιοχές Θεσσαλονίκης
            '560', '561', '562', '563', '564', '565', '566', '567', '568', '569', // Κεντρικές περιοχές Θεσσαλονίκης
        ];

        // Εισαγωγή των ταχυδρομικών κωδίκων για τη Ζώνη 1 (Αστικά Κέντρα - Αθήνα/Θεσσαλονίκη)
        $urbanCentersPostalCodes = [
            // Ευρύτερη περιοχή Αθήνας
            '100', '101', '102', '103', // Περιοχές Αθήνας που δεν καλύπτονται από τη Ζώνη 6
            '120', '121', '122', '123', '124', '125', '126', '127', '128', '129', // Προάστια Αθήνας
            '130', '131', '132', '133', '134', '135', '136', '137', '138', '139', // Προάστια Αθήνας
            // Ευρύτερη περιοχή Θεσσαλονίκης
            '530', '531', '532', '533', '534', '535', '536', '537', '538', '539', // Περιοχές Θεσσαλονίκης που δεν καλύπτονται από τη Ζώνη 7
            '540', '541', '542', '543', '544', '545', // Περιοχές Θεσσαλονίκης που δεν καλύπτονται από τη Ζώνη 7
            '570', '571', '572', '573', '574', '575', '576', '577', '578', '579', // Προάστια Θεσσαλονίκης
        ];

        // Εισαγωγή των ταχυδρομικών κωδίκων για τη Ζώνη 2 (Πρωτεύουσες Νομών Ηπειρωτικής Ελλάδας)
        $mainlandCapitalsPostalCodes = [
            '2210', // Πάτρα
            '2410', // Καλαμάτα
            '2710', // Ιωάννινα
            '3010', // Αγρίνιο
            '3210', // Λαμία
            '3510', // Λάρισα
            '3710', // Βόλος
            '4310', // Κοζάνη
            '4510', // Ιωάννινα
            '4910', // Κομοτηνή
            '5210', // Δράμα
            '5810', // Σέρρες
            '5910', // Βέροια
            '6110', // Κατερίνη
            '6510', // Καβάλα
            '6710', // Ξάνθη
            '6910', // Αλεξανδρούπολη
        ];

        // Εισαγωγή των ταχυδρομικών κωδίκων στον πίνακα
        $this->insertPostalCodes($athensPostalCodes, 6);
        $this->insertPostalCodes($thessalonikiPostalCodes, 7);
        // Προσωρινά απενεργοποιούμε τις υπόλοιπες εισαγωγές μέχρι να διορθωθεί το πρόβλημα
        // $this->insertPostalCodes($urbanCentersPostalCodes, 1);
        // $this->insertPostalCodes($mainlandCapitalsPostalCodes, 2);

        // Εισαγωγή των υπόλοιπων ταχυδρομικών κωδίκων για τις ζώνες 3, 4 και 5
        // Για συντομία, χρησιμοποιούμε προεπιλεγμένες τιμές για τις υπόλοιπες ζώνες

        // Ζώνη 3 (Λοιπή Ηπειρωτική Ελλάδα & Εύβοια)
        // $this->insertPostalCodes(['20', '21', '22', '23', '24', '25', '26', '27', '28', '29'], 3);
        // $this->insertPostalCodes(['30', '31', '32', '33', '34', '35', '36', '37', '38', '39'], 3);
        // $this->insertPostalCodes(['40', '41', '42', '43', '44', '45', '46', '47', '48'], 3);
        // $this->insertPostalCodes(['50', '51', '52', '58', '59'], 3);
        // $this->insertPostalCodes(['60', '61', '62', '63', '64', '65', '66', '67', '68', '69'], 3);
        // $this->insertPostalCodes(['70', '71', '72'], 3);

        // Ζώνη 4 (Νησιά - Εξαιρουμένων Δυσπρόσιτων)
        // $this->insertPostalCodes(['73', '74', '75', '76'], 4); // Κρήτη
        // $this->insertPostalCodes(['81', '82', '83', '84', '85'], 4); // Νησιά Αιγαίου
        // $this->insertPostalCodes(['49'], 4); // Κέρκυρα

        // Ζώνη 5 (Δυσπρόσιτες Περιοχές)
        // $this->insertPostalCodes(['18'], 5); // Νησιά Σαρωνικού
        // $this->insertPostalCodes(['86'], 5); // Μικρά νησιά Δωδεκανήσου
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        // Διαγραφή όλων των εγγραφών από τον πίνακα postal_code_zones
        DB::table('postal_code_zones')->delete();
    }

    /**
     * Εισαγωγή ταχυδρομικών κωδίκων για μια συγκεκριμένη ζώνη.
     *
     * @param array $postalCodes Οι ταχυδρομικοί κώδικες
     * @param int $zoneId Το ID της ζώνης
     */
    private function insertPostalCodes(array $postalCodes, int $zoneId): void
    {
        $data = [];
        foreach ($postalCodes as $postalCode) {
            $data[] = [
                'postal_code_prefix' => $postalCode,
                'shipping_zone_id' => $zoneId,
            ];
        }

        // Εισαγωγή των δεδομένων σε batches για καλύτερη απόδοση
        $chunks = array_chunk($data, 100);
        foreach ($chunks as $chunk) {
            DB::table('postal_code_zones')->insert($chunk);
        }
    }
};
